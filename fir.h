#ifndef __FIR_H__
#define __FIR_H__

#include <stdlib.h>
#include <stdint.h>
#include <string.h>

/*
200K sample, order 128, 129 points, cut 20hz
-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -7, -7, -7, 32761, -7, -7, -7, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -5, -5, -5, -5, -5, -5, -5, -5, -4, -4, -4, -4, -4, -4, -4, -3, -3, -3, -3, -3, -3, -3, -2, -2, -2, -2, -2, -2, -2, -2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
*/

/*
200K sample, order 256, 257 points, cut 20hz
-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -7, -7, -7, -7, -7, -7, -7, 32761, -7, -7, -7, -7, -7, -7, -7, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -6, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -3, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
*/

/*
1200K sample, order 128, 129 points, cut 20hz
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 32766, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
*/

/*
1200K sample, order 256, 257 points, cut 20hz
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 32766, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
*/

/*
    fSample: 50000 Hz

    * 0 Hz - 15000 Hz
        gain = 1
        desired ripple = 1 dB
        actual ripple = 1 dB

    * 19000 Hz - 25000 Hz
        gain = 0
        desired attenuation = -80 dB
        actual attenuation = -80 dB
*/
#define AUDIO_LPF_CUTOFF 19000
#define AUDIO_LPF_TAP_NUM 33
static int16_t audio_lpf_coefs[AUDIO_LPF_TAP_NUM] =
{
    -194,
    -439,
    -9,
    419,
    -215,
    -158,
    671,
    -302,
    -502,
    1185,
    -379,
    -1273,
    2314,
    -430,
    -4120,
    9263,
    21397,
    9263,
    -4120,
    -430,
    2314,
    -1273,
    -379,
    1185,
    -502,
    -302,
    671,
    -158,
    -215,
    419,
    -9,
    -439,
    -194
};

/*
    fSample: 200000 Hz

    * 0 Hz - 19000 Hz
        gain = 0
        desired attenuation = -60 dB
        actual attenuation = -60 dB

    * 24000 Hz - 52000 Hz
        gain = 1
        desired ripple = 1 dB
        actual ripple = 1 dB

    * 55500 Hz - 100000 Hz
        gain = 0
        desired attenuation = -50 dB
        actual attenuation = -50 dB
*/
#define STEREO_BPF_LOW_CUTOFF 16000
#define STEREO_BPF_HIGH_CUTOFF 22000
#define STEREO_BPF_TAP_NUM 95
static int16_t stereo_bpf_coefs[STEREO_BPF_TAP_NUM] =
{
    43,
    -100,
    -146,
    98,
    318,
    43,
    -375,
    -204,
    305,
    267,
    -213,
    -258,
    93,
    110,
    -64,
    150,
    320,
    -127,
    -507,
    -153,
    192,
    -21,
    19,
    547,
    430,
    -409,
    -567,
    -27,
    -140,
    -514,
    244,
    1158,
    513,
    -455,
    -66,
    82,
    -1266,
    -1492,
    684,
    1738,
    320,
    485,
    2505,
    146,
    -6299,
    -6181,
    3673,
    10170,
    3673,
    -6181,
    -6299,
    146,
    2505,
    485,
    320,
    1738,
    684,
    -1492,
    -1266,
    82,
    -66,
    -455,
    513,
    1158,
    244,
    -514,
    -140,
    -27,
    -567,
    -409,
    430,
    547,
    19,
    -21,
    192,
    -153,
    -507,
    -127,
    320,
    150,
    -64,
    110,
    93,
    -258,
    -213,
    267,
    305,
    -204,
    -375,
    43,
    318,
    98,
    -146,
    -100,
    43
};

/*
    fSample: 200000 Hz

    * 0 Hz - 53000 Hz
        gain = 0
        desired attenuation = -60 dB
        actual attenuation = -60 dB

    * 55500 Hz - 58500 Hz
        gain = 1
        desired ripple = 1 dB
        actual ripple = 1 dB

    * 61000 Hz - 100000 Hz
        gain = 0
        desired attenuation = -40 dB
        actual attenuation = -40 dB
*/
#define RDS_BPF_LOW_CUTOFF 53000
#define RDS_BPF_HIGH_CUTOFF 61000
#define RDS_BPF_TAP_NUM 167
static int16_t rds_bpf_coefs[RDS_BPF_TAP_NUM] =
{
    -58,
    97,
    -58,
    -31,
    69,
    8,
    -80,
    33,
    82,
    -77,
    -55,
    119,
    7,
    -137,
    61,
    127,
    -127,
    -77,
    177,
    1,
    -189,
    88,
    160,
    -164,
    -88,
    209,
    -4,
    -206,
    97,
    157,
    -160,
    -77,
    181,
    -8,
    -153,
    71,
    94,
    -91,
    -27,
    65,
    -13,
    -7,
    6,
    -51,
    54,
    72,
    -149,
    -28,
    241,
    -91,
    -280,
    265,
    226,
    -445,
    -60,
    569,
    -203,
    -574,
    509,
    423,
    -781,
    -115,
    931,
    -302,
    -893,
    741,
    637,
    -1095,
    -191,
    1263,
    -365,
    -1177,
    914,
    829,
    -1326,
    -274,
    1496,
    -379,
    -1368,
    990,
    958,
    -1423,
    -344,
    1579,
    -344,
    -1423,
    958,
    990,
    -1368,
    -379,
    1496,
    -274,
    -1326,
    829,
    914,
    -1177,
    -365,
    1263,
    -191,
    -1095,
    637,
    741,
    -893,
    -302,
    931,
    -115,
    -781,
    423,
    509,
    -574,
    -203,
    569,
    -60,
    -445,
    226,
    265,
    -280,
    -91,
    241,
    -28,
    -149,
    72,
    54,
    -51,
    6,
    -7,
    -13,
    65,
    -27,
    -91,
    94,
    71,
    -153,
    -8,
    181,
    -77,
    -160,
    157,
    97,
    -206,
    -4,
    209,
    -88,
    -164,
    160,
    88,
    -189,
    1,
    177,
    -77,
    -127,
    127,
    61,
    -137,
    7,
    119,
    -55,
    -77,
    82,
    33,
    -80,
    8,
    69,
    -31,
    -58,
    97,
    -58
};

/*
    fSample: 200000 Hz

    * 0 Hz - 16000 Hz
        gain = 0
        desired attenuation = -60 dB
        actual attenuation = -60 dB

    * 18500 Hz - 19500 Hz
        gain = 1
        desired ripple = 2 dB
        actual ripple = 2 dB

    * 22000 Hz - 100000 Hz
        gain = 0
        desired attenuation = -60 dB
        actual attenuation = -60 dB
*/
#define PILOT_19KHZ_BPF_LOW_CUTOFF 16000
#define PILOT_19KHZ_BPF_HIGH_CUTOFF 22000
#define PILOT_19KHZ_BPF_TAP_NUM 171
static int16_t pilot_19khz_bpf_coefs[PILOT_19KHZ_BPF_TAP_NUM] =
{
    9,
    18,
    5,
    5,
    -7,
    -15,
    -22,
    -21,
    -11,
    6,
    26,
    40,
    41,
    27,
    -2,
    -36,
    -63,
    -71,
    -53,
    -11,
    43,
    90,
    110,
    92,
    36,
    -43,
    -117,
    -158,
    -145,
    -76,
    30,
    139,
    210,
    212,
    135,
    0,
    -151,
    -263,
    -290,
    -213,
    -51,
    146,
    308,
    373,
    308,
    125,
    -118,
    -338,
    -453,
    -413,
    -222,
    64,
    345,
    522,
    522,
    336,
    18,
    -324,
    -569,
    -625,
    -460,
    -125,
    271,
    588,
    710,
    585,
    249,
    -187,
    -572,
    -768,
    -699,
    -383,
    76,
    519,
    790,
    790,
    514,
    53,
    -433,
    -774,
    -849,
    -629,
    -189,
    320,
    719,
    870,
    719,
    320,
    -189,
    -629,
    -849,
    -774,
    -433,
    53,
    514,
    790,
    790,
    519,
    76,
    -383,
    -699,
    -768,
    -572,
    -187,
    249,
    585,
    710,
    588,
    271,
    -125,
    -460,
    -625,
    -569,
    -324,
    18,
    336,
    522,
    522,
    345,
    64,
    -222,
    -413,
    -453,
    -338,
    -118,
    125,
    308,
    373,
    308,
    146,
    -51,
    -213,
    -290,
    -263,
    -151,
    0,
    135,
    212,
    210,
    139,
    30,
    -76,
    -145,
    -158,
    -117,
    -43,
    36,
    92,
    110,
    90,
    43,
    -11,
    -53,
    -71,
    -63,
    -36,
    -2,
    27,
    41,
    40,
    26,
    6,
    -11,
    -21,
    -22,
    -15,
    -7,
    5,
    5,
    18,
    9
};

/*
    fSample: 200000 Hz

    * 0 Hz - 20000 Hz
        gain = 0
        desired attenuation = -80 dB
        actual attenuation = -80 dB

    * 37000 Hz - 100000 Hz
        gain = 1
        desired ripple = 1 dB
        actual ripple = 1 dB
*/
#define PILOT_38KHZ_HPF_CUTOFF 37000
#define PILOT_38KHZ_HPF_TAP_NUM 31
static int16_t pilot_38khz_hpf_coefs[PILOT_38KHZ_HPF_TAP_NUM] =
{
    191,
    -241,
    -406,
    388,
    348,
    398,
    -383,
    -839,
    -730,
    481,
    1728,
    1751,
    -576,
    -4667,
    -8672,
    22460,
    -8672,
    -4667,
    -576,
    1751,
    1728,
    481,
    -730,
    -839,
    -383,
    398,
    348,
    388,
    -406,
    -241,
    191
};

/*
    fSample: 200000 Hz

    * 0 Hz - 20000 Hz
        gain = 0
        desired attenuation = -80 dB
        actual attenuation = -80 dB

    * 56000 Hz - 100000 Hz
        gain = 1
        desired ripple = 1 dB
        actual ripple = 1 dB
*/
#define PILOT_57KHZ_HPF_CUTOFF 56000
#define PILOT_57KHZ_HPF_TAP_NUM 15
static int16_t pilot_57khz_hpf_coefs[PILOT_57KHZ_HPF_TAP_NUM] =
{
    265,
    -405,
    -861,
    1250,
    2214,
    -1638,
    -10059,
    18469,
    -10059,
    -1638,
    2214,
    1250,
    -861,
    -405,
    265
};

typedef struct fir_filter_t
{
    int16_t *psCoefs;
    int16_t *psData;
    uint32_t ulTaps;
    uint32_t ulLastIndex;
} fir_filter_t;

fir_filter_t *fir_init(int16_t *pusCoefs, uint32_t ulTaps);
void fir_cleanup(fir_filter_t *pFilter);
int16_t fir_filter(fir_filter_t *pFilter, int16_t sSample);

#endif
